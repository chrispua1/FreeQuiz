<!DOCTYPE html>

<html>
    <head>
        <title>LINQ | Flashcards</title>
        <style>
            h1, p, #card, button {
                margin: auto;
            }

            #card {
                width: 50vw;
                height: 30vw;
                perspective: 1000px;
            }

            #inner-card {
                position: relative;
                width: 100%;
                height: 100%;
                text-align: center;
                transition: transform 0.8s;
                transform-style: preserve-3d;
            }

            #card.flipped #inner-card {
                transform: rotateY(180deg);
            }

            #front, #back {
                position: absolute;
                width: 100%;
                height: 100%;
                border-radius: 10px;
                border: 2px solid lightgray;
                -webkit-backface-visibility: hidden;
                backface-visibility: hidden;
            }

            #front {
                background-color: white;
            }

            #back {
                background-color: white;
                transform: rotateY(180deg);
            }
        </style>
    </head>
    <body>
        <h1>Flashcards</h1>
        <p><span id="counter"></span> / <span id="cards"></span></p>
        <div id="card" onClick="flip()">
            <div id="inner-card">
                <div id="front"></div>
                <div id="back"></div>
            </div>
        </div>
        <button id="prev" onClick="prev()">&lt;</button>
        <button id="flip" onClick="flip()">Flip flashcard</button>
        <button id="next" onClick="next()">&gt;</button>

        <script>
            const url = new URL(window.location.href);
            let params = new URLSearchParams(url.search);
            let flashcard = document.getElementById("card");
            let cardFront = document.getElementById("front");
            let cardBack = document.getElementById("back");
            let card = 0;
            let flipped = false;

            let safeString = "";
            switch (params.get("version")) {
                case "1":
                    safeString = atob(decodeURIComponent(params.get("cards")))
                        .replaceAll("&", "&amp;")
                        .replaceAll("<", "&lt;")
                        .replaceAll(">", "&gt;")
                        .replaceAll('"', "&quot;")
                        .replaceAll("'", "&apos;");
                    break;
            }
            let flashcards = safeString.split(/\r\n|\r|\n/g);
            let cards = [];
            flashcards.forEach((element) => {
                let theCard = element.split("\t");
                cards.push({front: theCard[0], back: theCard[1]});
            });
            
            document.getElementById("cards").innerText = cards.length;
            writeCard();
            
            function flip() {
                flipped = !flipped;
                orient();
            }

            function prev() {
                if (card > 0) {
                    card--;
                    orient();
                    writeCard();
                }
            }

            function next() {
                if (card < cards.length - 1) {
                    card++;
                    flipped = false;
                    orient();
                    writeCard();
                }
            }

            function writeCard() {
                front.innerHTML = "<p>" + cards[card].front + "</p>";
                back.innerHTML = "<p>" + cards[card].back + "</p>";
                document.getElementById("counter").innerText = card + 1;
            }

            function orient() {
                if (flipped) flashcard.classList.add("flipped");
                else flashcard.classList.remove("flipped");
            }
        </script>
    </body>
</html>
